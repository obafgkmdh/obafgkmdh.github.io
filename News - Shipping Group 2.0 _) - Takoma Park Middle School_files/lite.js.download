// ready
var on_ready_functions = [];
var run_on_ready_functions = false;

// test mode
var test_mode = false;

// subscriptions mode
var subscriptions_mode = false;

// jwplayer debug mode
var jwplayer_debug_mode = false;

// flowplayer debug mode
var flowplayer_debug_mode = false;

// highcharts mode
var highcharts_mode = false;

// new editor
var new_editor = false;

// new gradebook changes
var new_grade = false;

// visitor mode
var visitor_mode = false;

// portal mode
var portal_mode = false;

// rtl mode
var rtl_mode = false;

// mobile app mode
var mobile_app_mode = false;

//mobile app login messages
var sent_mobile_login_messages = false;

// video recording
var video_recording_mode = false;
var video_test_mode = false;

//grey page background
var grey_page_mode = false;

// translations
var no_messages_text;
var no_notifications_text;
var chat_request_text;
var accept_text;
var ignore_text;
var you_have_selected_all_text;
var select_all_items_text;
var all_items_selected_text;
var clear_selection_text;
var are_you_sure_text;
var chat_request_canceled_text;
var no_events_this_month_text;
var no_events_this_week_text;
var access_code_text;
var email_address_text;
var sticky_question_text;
var file_text;
var save_text;
var cancel_text;
var comment_text;
var send_text;
var send_message_text;
var send_to_text;
var students_text;
var teachers_text;
var managers_text;
var parents_text;
var administrators_text;
var close_text;
var picker_empty_text;
var picker_limit_text;
var select_all_text;
var deselect_all_text;
var alert_box_title;
var confirmation_box_title;


var help_for_page;

// mobile
var stylesheet_mobile;
var portal_stylesheet_url;
var mobile_menu_highlight_override;

function set_mobile_vars(stylesheet, menu_highlight){
	stylesheet_mobile = stylesheet.replace('href="/', 'href="'+window.location.protocol+'//'+window.location.host+'/');
	portal_stylesheet_url = stylesheet_mobile.replace('" media="screen" rel="stylesheet" title="theme" type="text/css" />', '').replace('<link href="', '');
	mobile_menu_highlight_override = menu_highlight;
}

function is_mobile_device() {
	return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
}

// functions

function on_ready(the_function) {
	if (run_on_ready_functions) {
		the_function();
	} else {
		on_ready_functions.push(the_function);
	}
}

function run_on_ready() {
	run_on_ready_functions = true;
	
	for (var i = 0; i < on_ready_functions.length; i++) {
		on_ready_functions[i]();
	}
}

// tables

function add_table_data(name, data) {
	on_ready(function() {$('#' + name).data('table', data);});
}

function add_option_bar(name) {
	on_ready(function() {init_options_bar(name);});
}

// focus

function set_focus(name) {
	on_ready(function() {focus_element(name);});
}

// signup

var signup_shown = false;

function set_signup(url) {
	on_ready(function() {
		if (!signup_shown) {
			$.facebox({'ajax': url}, 'hide_close');
			signup_shown = true;
		}
	});
}

// welcome

var welcome_shown = false;

function set_welcome(url) {
	on_ready(function() {
		if (!welcome_shown) {
			$.facebox({'ajax': url}, 'hide_close');
			welcome_shown = true;
		}
	});
}

// terms

var terms_shown = false;

function show_terms() {
  on_ready(function() {
    if (!terms_shown) {
      $.facebox({'ajax': '/accept_terms'}, 'hide_close');
      terms_shown = true;
    }
  });
}

// toggles

function add_checked_toggle(id) {
	on_ready(function() {checked_toggle(id);});
}

// translations

function set_translations(options) {
	no_messages_text = options.no_messages_text;
	no_notifications_text = options.no_notifications_text;
	chat_request_text = options.chat_request_text;
	accept_text = options.accept_text;
	ignore_text = options.ignore_text;
	you_have_selected_all_text = options.you_have_selected_all_text;
	select_all_items_text = options.select_all_items_text;
	all_items_selected_text = options.all_items_selected_text;
	clear_selection_text = options.clear_selection_text;
	are_you_sure_text = options.are_you_sure_text;
	chat_request_canceled_text = options.chat_request_canceled_text;
	no_events_this_month_text = options.no_events_this_month_text;
	no_events_this_week_text = options.no_events_this_week_text;
	access_code_text = options.access_code_text;
	email_address_text = options.email_address_text;
	sticky_question_text = options.sticky_question_text;
	file_text = options.file_text;
	save_text = options.save_text;
	cancel_text = options.cancel_text;
	comment_text = options.comment_text;
	send_text = options.send_text;
	send_message_text = options.send_message_text;
	send_to_text = options.send_to_text;
	students_text = options.students_text;
	teachers_text = options.teachers_text;
	managers_text = options.managers_text;
	parents_text = options.parents_text;
	administrators_text = options.administrators_text;
	close_text = options.close_text;
	picker_empty_text = options.picker_empty_text;
	picker_limit_text = options.picker_limit_text;
	alert_box_title = options.alert_box_title;
  confirmation_box_title = options.confirmation_box_title;
  select_all_text = options.select_all_text;
  deselect_all_text = options.deselect_all_text;
}

// test mode

function set_test_mode() {
	test_mode = true;
}

function is_test_mode() {
	return test_mode;	
}

// new editor

function set_new_editor() {
	new_editor = true;
}

function is_new_editor() {
	return new_editor;	
}

// test mode

function set_video_recording_mode() {
	video_recording_mode = true;
}

function is_video_recording_mode() {
	return video_recording_mode;
}

function set_video_test_mode() {
	video_test_mode = true;
}

function is_video_test_mode() {
	return video_test_mode;
}

function set_grey_page_mode() {
	grey_page_mode = true;
}

function is_grey_page_mode() {
	return grey_page_mode;
}

function is_webm_supported(){
	var testEl = document.createElement("video"), mpeg4, h264, ogg, webm;
	if (testEl.canPlayType && testEl.canPlayType('video/webm; codecs="vp8, vorbis"')) {
		return true;
	}
	return false;
}

// new gradebook changes

function set_new_grade() {
	new_grade = true;
}

function is_new_grade() {
	return new_grade;	
}

// subscriptions mode

function set_subscriptions_mode() {
	subscriptions_mode = true;
}

function is_subscriptions_mode() {
	return subscriptions_mode;
}

// jwplayer debug mode

function set_jwplayer_debug_mode() {
  jwplayer_debug_mode = true;
}

function is_jwplayer_debug_mode() {
  return jwplayer_debug_mode;
}

// flowplayer debug mode

function set_flowplayer_debug_mode() {
  flowplayer_debug_mode = true;
}

function is_flowplayer_debug_mode() {
  return flowplayer_debug_mode;
}

// visitor mode

function set_visitor_mode() {
	visitor_mode = true;
}

function is_visitor_mode() {
	return visitor_mode;	
}

// portal mode

function set_portal_mode() {
	portal_mode = true;
}

function is_portal_mode() {
	return portal_mode;	
}

// rtl mode

function set_rtl_mode() {
	rtl_mode = true;
}

function is_rtl_mode() {
	return rtl_mode;	
}

// mobile mode

function set_mobile_app_mode() {
	mobile_app_mode = true;
}

function is_mobile_app_mode() {
	if (/Android/i.test(navigator.userAgent)) {
		return false;
	} else {
		return mobile_app_mode;
	}
}

// help for this page

function set_help_for_page(string){
	help_for_page = string;
}

function get_help_for_page(){
	if (typeof help_for_page != 'undefined') {
		return help_for_page;
	} else {
		return false;
	}
}

function update_left_nav_storage(content){
	if (is_mobile_app_mode() || Modernizr.localstorage) {
		localStorage.setItem("left_nav_content", content);
	}
}

function update_mobile_nav_storage(content){
	if (is_mobile_app_mode() || Modernizr.localstorage) {
		localStorage.setItem("mobile_nav_content", content);
	}
}