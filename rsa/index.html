<!DOCTYPE html>
<html>
<head>
    <title>i need a good title</title>
    <style>
        .warning {
            background:yellow;
        }
        .error {
            background:red;
            color:white;
        }
        .success {
            background:lime;
        }
    </style>
    <script src="biginteger.js"></script>
</head>
<body>
    <script>
        function escapeHtml(text) {
          var map = {
            '&': '&amp;',
            '<': '&lt;',
            '>': '&gt;',
            '"': '&quot;',
            "'": '&#039;'
          };
          return text.replace(/[&<>"']/g, function(m) { return map[m]; });
        }
        function decrypt1(c,d,n){
            return c.modPow(d,n);
        }
        function decrypt2(p,q,c,e,n){
            return decrypt1(c,modInv(e,p.prev().multiply(q.prev())),n);
        }
        function rsa(){
            try{
                var vars={
                    n:document.getElementById("n").value,
                    e:document.getElementById("e").value,
                    c:document.getElementById("c").value,
                    d:document.getElementById("d").value,
                    p:document.getElementById("p").value,
                    q:document.getElementById("q").value
                };
                for(var i in vars){if(vars[i]==""){delete vars[i];}else{vars[i]=bigInt(vars[i]);}}
                //error checking
                if(!vars.c){
                    document.getElementById("result").innerHTML+="<br><span class='warning'>Warning: no value for c specified.</span>"
                }
                if(!vars.e&&!vars.d){
                    document.getElementById("result").innerHTML+="<br><span class='warning'>Warning: no values for e or d specified.</span>"
                }
                if(!vars.n){
                    document.getElementById("result").innerHTML+="<br><span class='warning'>Warning: no value for n specified.</span>"
                }
                if(vars.p&&vars.q&&vars.n&&vars.p.multiply(vars.q).neq(vars.n)){
                    throw ("<span class='error'>Error: inconsistency between p, q, and n</span>");
                }
                if(vars.d&&vars.e&&vars.n&&bigInt(2).modPow(vars.d.multiply(vars.e),vars.n).neq(bigInt(2))){
                    throw ("<span class='error'>Error: inconsistency between d and e</span>");
                }

                //computation
                if(!vars.p&&!vars.q&&vars.n){
                    //todo: get factor tables
                }
                if(vars.p&&vars.q){
                    if(vars.d){
                        document.getElementById("result").innerHTML+="<br><span class='success'>Decrypted message found: "+decrypt1(vars.c,vars.d,vars.p.multiply(vars.q))+"</span>";
                        return;
                    }
                    else if(vars.e){
                        document.getElementById("result").innerHTML+="<br><span class='success'>Decrypted message found: "+decrypt2(vars.p,vars.q,vars.c,vars.e,vars.p.multiply(vars.q))+"</span>";
                        return;
                    }
                }
                else if(vars.n&&vars.p){
                    vars.q=vars.n.over(vars.p);
                    if(vars.d){
                        document.getElementById("result").innerHTML+="<br><span class='success'>Decrypted message found: "+decrypt1(vars.c,vars.d,vars.p.multiply(vars.q))+"</span>";
                        return;
                    }
                    else if(vars.e){
                        document.getElementById("result").innerHTML+="<br><span class='success'>Decrypted message found: "+decrypt2(vars.p,vars.q,vars.c,vars.e,vars.p.multiply(vars.q))+"</span>";
                        return;
                    }
                }
                else if(vars.n&&vars.q){
                    vars.p=vars.n.over(vars.q);
                    if(vars.d){
                        document.getElementById("result").innerHTML+="<br><span class='success'>Decrypted message found: "+decrypt1(vars.c,vars.d,vars.p.multiply(vars.q))+"</span>";
                        return;
                    }
                    else if(vars.e){
                        document.getElementById("result").innerHTML+="<br><span class='success'>Decrypted message found: "+decrypt2(vars.p,vars.q,vars.c,vars.e,vars.p.multiply(vars.q))+"</span>";
                        return;
                    }
                }
                else if(vars.n){
                    //do stuff
                }
                else{
                    //take e'th root, if no e, guess fermat primes
                }
            }
            catch(e){
                console.log(e);
                document.getElementById("result").innerHTML+="Something went wrong. :("+escapeHtml(e);
            }
        }
    </script>
    <p>if you want inputs to be hex put 0x before it, if you want it to be binary put 0b before it</p>
    <p>n: <input name="n" id="n"></p>
    <p>e: <input name="e" id="e"></p>
    <p>c: <input name="c" id="c"></p>
    <p>d: <input name="d" id="d"></p>
    <p>p: <input name="p" id="p"></p>
    <p>q: <input name="q" id="q"></p>
    <p><button onclick="rsa()">Submit</button></p>
    <div id="result"></div>
</body>
</html>
